<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<div class="bigcontainer">
    <div class="new-header">Tạo bài viết mới</div>
    <div class="new-container">
        <form id="new-article-form" method="POST" enctype="multipart/form-data">
            <div class="new-title">
                <span>Tiêu đề:</span>
                <input type="text" name="header" id="tieude"></input>
            </div>
            <div class="new-cat">
                <span>Chuyên mục lớn:</span>
                <select name="cat" id="chuyenmuc" onchange="populate(this.id,'chuyenmucnho')">
                    <option value=""></option>
                    <% cat.forEach(function(row){%>
                    <option id="<%=row.ID%>" value="<%=row.name%>"><%=row.name%></option>
                    <%})%>
                </select>
            </div>
            <div class="new-subcat">
                    <span>Chuyên mục nhỏ:</span>
                    <select name="subcat" id="chuyenmucnho">
                    <option value=""></option>    
                    </select>
                </div>
            <div class="new-pic">
                <span>Ảnh đại diện:</span>
                <input id="input-b2" name="image" type="file" class="file" data-show-preview="false" accept="image/*">
            </div>
            <div class="new-abstract">
                <span>Tóm tắt:</span>
                <textarea name="abstract" id="tomtat"></textarea>
            </div>
            <div class="new-body">
            <span>Nội dung:</span>
                <div id="quill-body"></div>
                <textarea id='content' name='content' hidden></textarea>
            </div>
            <div class="new-tag">
                <span>Gán nhãn:</span>
                <input type="text" name="tag" placeholder="tag1,tag2,tag3">
            </div>
            <button class="article-submit" id="article-submit">Tạo bài viết</button>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script type="text/javascript" src="/public/new-article.js"></script>
<script type="text/javascript">
function populate(s1,s2){ 
  var s1=document.getElementById(s1);
  var s2=document.getElementById(s2);
  s2.innerHTML="";

  var s1id=s1[s1.selectedIndex].id;

  var sc=<%- JSON.stringify(subcat)%>
  console.log(sc);
  console.log(s1id);
  sc.forEach(element => {
      console.log(element.belongto);
      if(element.belongto==s1id)
      {
    var newOp=document.createElement("option");
    newOp.value=element.name;
    newOp.innerHTML=element.name;
    s2.options.add(newOp);
      }
  });
}
</script>
<script>
    $(function(){
        $('#input-b2').fileinput({
            allowedFileExtensions: ['png', 'jpg'],
            uploadUrl:'/new',
            uploadASync: false,
        })
    })
    $('#new-article-form').submit(function() {
        $('div.ql-editor').attr('id', 'ql-editor');
    var markup = $('#ql-editor', '#new-article-form').html();
    console.log(markup);
    $('#content', '#new-article-form').val( markup );
});
</script>
